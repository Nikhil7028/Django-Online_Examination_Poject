<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Paper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <style>
        .main {
            margin: 9px 4px 5px 130px;
            padding: 4px 5px 5px 26px;
            border: 9px solid #c9cbc378;
            border-radius: 15px;
            border-bottom: none;
        }

        .up {
            font-size: 24px;
            font-weight: bold;
            border: 3px solid orange;
            background-color: wheat;
        }
    </style>
</head>
<body>
    <div class="up">
        <ul>
            <li><b>Candidate: </b> {{ user }}</li>
            <li style="display: inline; float:right; padding-right: 10px; padding-bottom: 10px;">
                <b>Time: </b>
                <div id="countdowntimer" style="display: inline; padding-right: 50px;"></div>
            </li>
            <li><b>Subject: </b> {{ sub }}</li>
        </ul>
    </div>

    <div class="main">
        <div class="row">
            <div class="col-lg-6 col-lg-push-3">
                <div class="row">
                    <div class="col-lg-2 col-lg-push-10" style="float:right; font-weight:bold;">
                        <div id="current_que" style="display: inline;">1</div>
                        <div style="display: inline;">/</div>
                        <div id="total_que" style="display: inline;">0</div>
                    </div>
                </div>

                <div class="row" style="margin-top: 30px;">
                    <div class="col-lg-10 col-lg-push-1" style="min-height: 300px; background-color: white;" id="load_questions"></div>
                    
                </div>


                <div class="row" style="margin-top: 10px">
                    <div class="col-lg-12 text-center">
                        <input type="button" class="btn btn-warning" value="Previous" onclick="load_previous();">&nbsp
                        <input type="button" class="btn btn-success" value="Next" onclick="load_next();">&nbsp
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function load_total_que() {
            fetch("{% url 'load_total_que' %}")
                .then(response => response.json())
                .then(data => document.getElementById("total_que").innerHTML = data);
        }

        let questionno = 1;
        load_questions(questionno);

        function load_questions(questionno) {
            document.getElementById("current_que").innerHTML = questionno;
            fetch("{% url 'load_questions' %}?questionno=" + questionno)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById("load_questions").innerHTML = `<p>${data.error}</p>`;
                    } else {
                        let questionHtml = `<div style="display: flex; align-items: flex-start;">`;
        
                        // Display image on the left if available
                        if (data.image_url) {
                            questionHtml += `<img src="${data.image_url}" alt="Question Image" style="width: 150px; height: auto; margin-right: 20px;">`;
                        }
        
                        // Display question text and options on the right
                        questionHtml += `<div>
                                            <p><b>${data.text}</b></p>
                                            <ul>`;
                        data.options.forEach((option, index) => {
                            questionHtml += `<li>
                                                <input type="radio" name="option" value="${index + 1}"> ${option}
                                             </li>`;
                        });
                        questionHtml += `</ul></div></div>`;
        
                        // Insert question and options into the HTML
                        document.getElementById("load_questions").innerHTML = questionHtml;
                    }
        
                    // Update the total number of questions
                    load_total_que();
                });
        }
        
        
        

        function load_previous() {
            if (questionno > 1) {
                questionno -= 1;
                load_questions(questionno);
            }
        }

        function load_next() {
            questionno += 1;
            load_questions(questionno);
        }

        function timer() {
            fetch("{% url 'load_timer' %}")
                .then(response => response.json())  // Parse the JSON response
                .then(data => {
                    document.getElementById("countdowntimer").innerHTML = data.time;  // Access the 'time' field
        
                    // Redirect to another page if time is up
                    if (data.time === "00:00:00") {
                        
                        window.location.href = "{% url 'selectSub' %}";  // Adjust URL as needed
                    }
                })
                .catch(error => console.error('Error fetching timer:', error));  // Error handling
        }
        
        // Set the timer to call every second
        setInterval(timer, 1000);

        setInterval(timer, 1000);
    </script>
</body>
</html>
